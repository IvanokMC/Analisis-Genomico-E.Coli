<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Gen√≥mico - E. coli K-12 MG1655</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00f0ff;
            --primary-dark: #00b8c4;
            --secondary: #7df9ff;
            --accent: #ff6b6b;
            --success: #00ff9f;
            --warning: #ffaa00;
            --bg-dark: #050012;
            --bg-card: rgba(10, 10, 40, 0.85);
            --border: rgba(0, 240, 255, 0.3);
        }

        body {
            background: radial-gradient(circle at top right, #0a0028, #050012, #000);
            color: #e0e0ff;
            font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
        }

        header {
            position: relative;
            text-align: center;
            padding: 60px 20px 40px;
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(0, 240, 255, 0.02));
            border-bottom: 3px solid var(--primary);
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            opacity: 0.3;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .bacteria-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            position: relative;
        }

        .bacteria {
            width: 100%;
            height: 100%;
            animation: float 4s ease-in-out infinite, rotate 20s linear infinite;
            filter: drop-shadow(0 0 20px var(--primary));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            animation: particleFloat 8s ease-in-out infinite;
            opacity: 0.6;
        }

        .particle:nth-child(1) { top: 20%; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { top: 40%; right: 15%; animation-delay: 2s; }
        .particle:nth-child(3) { bottom: 30%; left: 20%; animation-delay: 4s; }
        .particle:nth-child(4) { top: 60%; right: 25%; animation-delay: 6s; }

        @keyframes particleFloat {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
            50% { transform: translate(30px, -30px) scale(1.5); opacity: 0.2; }
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .subtitle {
            color: var(--secondary);
            font-size: 1.3em;
            margin-top: 10px;
            font-weight: 300;
        }

        .author {
            color: #999;
            font-size: 0.95em;
            margin-top: 15px;
            font-style: italic;
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-card);
            border-right: 2px solid var(--border);
            padding: 30px 0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }

        .sidebar-title {
            color: var(--primary);
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ccc;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(0, 240, 255, 0.1);
            border-left-color: var(--primary);
            color: var(--primary);
            padding-left: 30px;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(0, 240, 255, 0.2), transparent);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .nav-item i {
            width: 24px;
            font-size: 1.2em;
        }

        .sidebar-toggle {
            position: fixed;
            left: 20px;
            top: 20px;
            z-index: 1001;
            background: var(--primary);
            color: #000;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            box-shadow: 0 4px 15px rgba(0, 240, 255, 0.5);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 240, 255, 0.7);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: linear-gradient(135deg, var(--bg-card), rgba(0, 240, 255, 0.05));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.1), transparent 70%);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .metric-card:hover::before {
            opacity: 1;
            transform: scale(1.2);
        }

        .metric-card:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 240, 255, 0.4);
            border-color: var(--secondary);
        }

        .metric-icon {
            font-size: 3em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            color: var(--secondary);
            font-size: 0.95em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2.5em;
            color: var(--primary);
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.5);
            margin-bottom: 8px;
        }

        .metric-subtext {
            color: #999;
            font-size: 0.85em;
        }

        .section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 2.2em;
            color: var(--primary);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .card:hover::after {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 50px rgba(0, 240, 255, 0.3);
            border-color: var(--primary);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card h3 {
            color: var(--secondary);
            margin: 30px 0 20px;
            font-size: 1.4em;
        }

        .stat-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.08), rgba(0, 240, 255, 0.02));
            padding: 28px;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.2), transparent);
            border-radius: 0 15px 0 100%;
        }

        .stat-item:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.15), rgba(0, 240, 255, 0.05));
            box-shadow: 0 10px 30px rgba(0, 240, 255, 0.3);
        }

        .stat-label {
            color: var(--secondary);
            font-size: 0.95em;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.3em;
            color: var(--primary);
            font-weight: bold;
            text-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
            margin-bottom: 10px;
        }

        .stat-subtext {
            color: #aaa;
            font-size: 0.88em;
            margin-top: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 28px;
            background: rgba(0, 240, 255, 0.1);
            border-radius: 14px;
            overflow: hidden;
            margin-top: 12px;
            border: 1px solid var(--border);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 14px;
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .info-box {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.15), rgba(0, 240, 255, 0.05));
            border: 2px solid var(--primary);
            border-left: 6px solid var(--primary);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
        }

        .info-box h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-box {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 107, 107, 0.05));
            border: 2px solid var(--accent);
            border-left: 6px solid var(--accent);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
        }

        .alert-box h3 {
            color: var(--accent);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-wrapper {
            overflow-x: auto;
            margin: 25px 0;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 240, 255, 0.02);
        }

        th, td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(0, 240, 255, 0.1));
            color: var(--primary);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }

        tr:hover {
            background: rgba(0, 240, 255, 0.08);
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(0, 240, 255, 0.3);
        }

        .validation-ok {
            background: var(--success);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        .validation-warning {
            background: var(--warning);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 35px;
            margin: 35px 0;
        }

        .chart-container {
            position: relative;
            height: 450px;
            background: rgba(0, 240, 255, 0.03);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        /* BOT√ìN VER GEN */
        .btn-ver-gen {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 240, 255, 0.3);
        }

        .btn-ver-gen:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 240, 255, 0.5);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background: var(--bg-card);
            margin: 40px auto;
            max-width: 900px;
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 240, 255, 0.5);
            position: relative;
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.5);
        }

        .gen-detalle {
            background: rgba(0, 240, 255, 0.08);
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .gen-titulo {
            color: var(--primary);
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: bold;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .codones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .codon-item {
            background: rgba(125, 249, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--secondary);
            text-align: center;
            transition: all 0.3s ease;
        }

        .codon-item:hover {
            transform: scale(1.1);
            background: rgba(125, 249, 255, 0.2);
            box-shadow: 0 4px 15px rgba(125, 249, 255, 0.3);
        }

        .codon-item .codon-label {
            color: var(--secondary);
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1em;
        }

        .codon-item .codon-count {
            color: var(--primary);
            font-size: 1.4em;
            margin-top: 8px;
            font-weight: bold;
        }

        /* COMPARATIVA */
        .selector-container {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
            padding: 30px;
            background: rgba(0, 240, 255, 0.05);
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        .selector-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .selector-item label {
            color: var(--secondary);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .selector-item select {
            padding: 14px 20px;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 10px;
            color: #e0e0ff;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .selector-item select:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.5);
        }

        .comparar-btn {
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: #000;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0, 240, 255, 0.4);
        }

        .comparar-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 240, 255, 0.6);
        }

        .comparativa-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }

        .genoma-card {
            background: rgba(0, 240, 255, 0.08);
            border: 2px solid var(--primary);
            padding: 25px;
            border-radius: 15px;
        }

        .genoma-titulo {
            color: var(--primary);
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-row strong {
            color: var(--secondary);
        }

        .diferencia-item {
            background: rgba(10, 40, 40, 0.5);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 5px solid var(--accent);
            transition: all 0.3s ease;
        }

        .diferencia-item:hover {
            transform: translateX(10px);
            background: rgba(10, 40, 40, 0.7);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .diferencia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .codon-badge {
            background: var(--primary);
            color: #000;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1em;
        }

        .diferencia-valor {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .valor-genoma {
            background: rgba(0, 240, 255, 0.1);
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .valor-genoma strong {
            color: var(--secondary);
        }

        .flecha-diferencia {
            color: var(--accent);
            font-size: 1.8em;
            font-weight: bold;
        }

        .loading {
            color: var(--secondary);
            font-style: italic;
            padding: 30px;
            text-align: center;
            font-size: 1.2em;
        }

        footer {
            text-align: center;
            padding: 40px;
            margin-top: 60px;
            border-top: 2px solid var(--border);
            background: var(--bg-card);
        }

        footer p {
            color: #999;
            margin: 8px 0;
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.visible {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            h1 {
                font-size: 2.2em;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .comparativa-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
            }

            h1 {
                font-size: 1.8em;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<button class="sidebar-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>

<div class="layout">
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">
                <i class="fas fa-dna"></i>
                Navegaci√≥n
            </div>
        </div>
        
        <div class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </div>
        
        <div class="nav-item" onclick="showSection('codones-cds')">
            <i class="fas fa-dna"></i>
            <span>Codones CDS</span>
        </div>
        
        <div class="nav-item" onclick="showSection('codones-genoma')">
            <i class="fas fa-search"></i>
            <span>Exploratorio</span>
        </div>
        
        <div class="nav-item" onclick="showSection('graficos')">
            <i class="fas fa-chart-line"></i>
            <span>Gr√°ficos</span>
        </div>
        
        <div class="nav-item" onclick="showSection('validacion')">
            <i class="fas fa-check-circle"></i>
            <span>Validaci√≥n</span>
        </div>
        
        <div class="nav-item" onclick="showSection('compactacion')">
            <i class="fas fa-compress"></i>
            <span>Compactaci√≥n</span>
        </div>
        
        <div class="nav-item" onclick="showSection('genes')">
            <i class="fas fa-microscope"></i>
            <span>Genes</span>
        </div>
        
        <div class="nav-item" onclick="showSection('espacios')">
            <i class="fas fa-ban"></i>
            <span>Espacios</span>
        </div>
        
        <div class="nav-item" onclick="showSection('comparativa')">
            <i class="fas fa-balance-scale"></i>
            <span>Comparativa</span>
        </div>
    </nav>

    <main class="main-content" id="mainContent">
        <header>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            
            <div class="header-content">
                <div class="bacteria-container">
                    <svg class="bacteria" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <ellipse cx="100" cy="100" rx="80" ry="40" fill="url(#grad1)" opacity="0.8"/>
                        <ellipse cx="100" cy="100" rx="70" ry="35" fill="url(#grad2)"/>
                        <path d="M 20 100 Q 10 80, 5 60" stroke="var(--primary)" stroke-width="2" fill="none" opacity="0.6"/>
                        <path d="M 20 100 Q 10 120, 5 140" stroke="var(--primary)" stroke-width="2" fill="none" opacity="0.6"/>
                        <path d="M 180 100 Q 190 80, 195 60" stroke="var(--primary)" stroke-width="2" fill="none" opacity="0.6"/>
                        <path d="M 180 100 Q 190 120, 195 140" stroke="var(--primary)" stroke-width="2" fill="none" opacity="0.6"/>
                        <circle cx="60" cy="90" r="3" fill="var(--secondary)"/>
                        <circle cx="80" cy="85" r="3" fill="var(--secondary)"/>
                        <circle cx="120" cy="85" r="3" fill="var(--secondary)"/>
                        <circle cx="140" cy="90" r="3" fill="var(--secondary)"/>
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--primary);stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:var(--secondary);stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:var(--primary);stop-opacity:0.9" />
                                <stop offset="50%" style="stop-color:var(--secondary);stop-opacity:0.7" />
                                <stop offset="100%" style="stop-color:var(--primary);stop-opacity:0.9" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                
                <h1>üß¨ An√°lisis Gen√≥mico</h1>
                <p class="subtitle"><i>Escherichia coli</i> K-12 MG1655</p>
                <p class="author">Universidad Nacional San Antonio Abad del Cusco</p>
            </div>
        </header>

        <div class="container">
            <!-- DASHBOARD -->
            <div id="dashboard" class="section active">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard Principal
                </h2>

                <div class="dashboard">
                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-ruler-horizontal"></i></div>
                        <div class="metric-label">Longitud del Genoma</div>
                        <div class="metric-value">{{ "%.2f"|format(genome_length / 1000000) }} Mb</div>
                        <div class="metric-subtext">{{ "{:,}".format(genome_length) }} pares de bases</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-percent"></i></div>
                        <div class="metric-label">Contenido GC</div>
                        <div class="metric-value">{{ "%.2f"|format(gc) }}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ gc }}%">{{ "%.1f"|format(gc) }}%</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-dna"></i></div>
                        <div class="metric-label">Total de Genes</div>
                        <div class="metric-value">{{ "{:,}".format(num_genes) }}</div>
                        <div class="metric-subtext">Secuencias codificantes</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon"><i class="fas fa-compress-arrows-alt"></i></div>
                        <div class="metric-label">Compactaci√≥n</div>
                        <div class="metric-value">{{ "%.1f"|format(compactacion.porcentaje_compactacion) }}%</div>
                        <div class="metric-subtext">Genoma eficiente</div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-check-double"></i> Resumen de Validaci√≥n</h2>
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">Estado General</div>
                            <div class="stat-value" style="color: var(--success);">
                                <i class="fas fa-check-circle"></i> VALIDADO
                            </div>
                            <div class="stat-subtext">Todos los par√°metros correctos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Literatura</div>
                            <div class="stat-value">100%</div>
                            <div class="stat-subtext">Blattner et al. (1997)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Codones STOP</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_cds.TAA + codones_stop_cds.TAG + codones_stop_cds.TGA) }}</div>
                            <div class="stat-subtext">Uno por gen ‚úÖ</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-trophy"></i> Genes Extremos</h2>
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">ü•á Gen m√°s GRANDE</div>
                            <div class="stat-value" style="color: var(--accent);">{{ gen_mas_grande.gen }}</div>
                            <p style="color: var(--secondary); margin-top: 12px;">{{ gen_mas_grande.producto[:50] }}...</p>
                            <p style="color: #aaa;">{{ "{:,}".format(gen_mas_grande.longitud) }} pb</p>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ü•â Gen m√°s PEQUE√ëO</div>
                            <div class="stat-value" style="color: var(--secondary);">{{ gen_mas_pequeno.gen }}</div>
                            <p style="color: var(--secondary); margin-top: 12px;">{{ gen_mas_pequeno.producto[:50] }}...</p>
                            <p style="color: #aaa;">{{ "{:,}".format(gen_mas_pequeno.longitud) }} pb</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CODONES CDS -->
            <div id="codones-cds" class="section">
                <h2 class="section-title">
                    <i class="fas fa-dna"></i>
                    Codones en CDS (M√©todo Correcto)
                </h2>

                <div class="info-box">
                    <h3><i class="fas fa-info-circle"></i> Metodolog√≠a Correcta</h3>
                    <p>
                        Este an√°lisis cuenta codones <strong>SOLO dentro de secuencias codificantes (CDS)</strong>, 
                        respetando el marco de lectura correcto (+0). Los resultados coinciden con la literatura cient√≠fica.
                    </p>
                </div>

                <div class="card">
                    <h2><i class="fas fa-play-circle"></i> An√°lisis de ATG</h2>
                    
                    <h3><i class="fas fa-flag-checkered"></i> ATG Iniciales</h3>
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">ATG Iniciales</div>
                            <div class="stat-value">{{ "{:,}".format(atg_stats.iniciales) }}</div>
                            <div class="stat-subtext">
                                <i class="fas fa-check-circle" style="color: var(--success);"></i> 
                                Esperado: {{ "{:,}".format(num_genes) }}
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">% Genes con ATG</div>
                            <div class="stat-value">{{ "%.1f"|format((atg_stats.iniciales / num_genes) * 100) }}%</div>
                            <div class="stat-subtext">La mayor√≠a usa ATG</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Cod√≥n Alternativo</div>
                            <div class="stat-value" style="color: var(--warning);">{{ atg_stats.genes_sin_atg }}</div>
                            <div class="stat-subtext">GTG, TTG, etc.</div>
                        </div>
                    </div>

                    <h3 style="margin-top: 40px;"><i class="fas fa-layer-group"></i> ATG Internos</h3>
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">Total ATG en CDS</div>
                            <div class="stat-value">{{ "{:,}".format(atg_stats.total_en_cds) }}</div>
                            <div class="stat-subtext">Iniciales + internos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ATG Internos</div>
                            <div class="stat-value">{{ "{:,}".format(atg_stats.no_iniciales) }}</div>
                            <div class="stat-subtext">Codifican Metionina</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Densidad ATG</div>
                            <div class="stat-value">{{ "%.2f"|format(atg_stats.total_en_cds / (genome_length / 1000)) }}</div>
                            <div class="stat-subtext">ATG por kb</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-stop-circle"></i> Codones STOP</h2>
                    
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">TAA (Ochre)</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_cds.TAA) }}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ stop_props_cds.TAA }}%">
                                    {{ "%.1f"|format(stop_props_cds.TAA) }}%
                                </div>
                            </div>
                            <div class="stat-subtext">
                                {{ "%.2f"|format(stop_props_cds.TAA) }}% (Esperado: 60-65%)
                                <span class="validation-ok">‚úì</span>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-label">TAG (Amber)</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_cds.TAG) }}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ stop_props_cds.TAG * 2 }}%; background: linear-gradient(90deg, var(--accent), #ff9999);">
                                    {{ "%.1f"|format(stop_props_cds.TAG) }}%
                                </div>
                            </div>
                            <div class="stat-subtext">
                                {{ "%.2f"|format(stop_props_cds.TAG) }}% (Esperado: 5-10%)
                                <span class="validation-ok">‚úì</span>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-label">TGA (Opal)</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_cds.TGA) }}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ stop_props_cds.TGA }}%; background: linear-gradient(90deg, var(--secondary), var(--primary));">
                                    {{ "%.1f"|format(stop_props_cds.TGA) }}%
                                </div>
                            </div>
                            <div class="stat-subtext">
                                {{ "%.2f"|format(stop_props_cds.TGA) }}% (Esperado: 25-35%)
                                <span class="validation-ok">‚úì</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-box" style="margin-top: 30px;">
                        <h3><i class="fas fa-chart-pie"></i> Resumen</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div style="background: rgba(0,240,255,0.08); padding: 20px; border-radius: 10px;">
                                <strong style="color: var(--secondary);">Total STOP:</strong><br>
                                <span style="color: var(--primary); font-size: 1.8em; font-weight: bold;">
                                    {{ "{:,}".format(codones_stop_cds.TAA + codones_stop_cds.TAG + codones_stop_cds.TGA) }}
                                </span><br>
                                <span style="color: #aaa; font-size: 0.9em;">Uno por gen</span>
                            </div>
                            <div style="background: rgba(0,240,255,0.08); padding: 20px; border-radius: 10px;">
                                <strong style="color: var(--secondary);">Validaci√≥n:</strong><br>
                                <span style="color: var(--success); font-size: 1.8em; font-weight: bold;">
                                    <i class="fas fa-check-circle"></i> 100%
                                </span><br>
                                <span style="color: #aaa; font-size: 0.9em;">Con literatura</span>
                            </div>
                            <div style="background: rgba(0,240,255,0.08); padding: 20px; border-radius: 10px;">
                                <strong style="color: var(--secondary);">M√°s Usado:</strong><br>
                                <span style="color: var(--primary); font-size: 1.8em; font-weight: bold;">
                                    TAA
                                </span><br>
                                <span style="color: #aaa; font-size: 0.9em;">63.97%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EXPLORATORIO -->
            <div id="codones-genoma" class="section">
                <h2 class="section-title">
                    <i class="fas fa-search"></i>
                    An√°lisis Exploratorio
                </h2>

                <div class="alert-box">
                    <h3><i class="fas fa-exclamation-triangle"></i> M√©todo Exploratorio</h3>
                    <p>Cuenta <strong>TODOS los tripletes</strong> sin considerar:</p>
                    <ul style="margin-left: 25px; margin-top: 15px; line-height: 1.8;">
                        <li>Si est√°n dentro de genes</li>
                        <li>Si respetan el marco de lectura</li>
                        <li>Si son funcionalmente activos</li>
                    </ul>
                </div>

                <div class="card">
                    <h2><i class="fas fa-layer-group"></i> Tripletes ATG</h2>
                    
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">Total Tripletes ATG</div>
                            <div class="stat-value">{{ "{:,}".format(atg_total_genoma) }}</div>
                            <div class="stat-subtext">En todo el genoma</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ATG Funcionales</div>
                            <div class="stat-value" style="color: var(--success);">{{ "{:,}".format(atg_stats.iniciales) }}</div>
                            <div class="stat-subtext">
                                {{ "%.2f"|format((atg_stats.iniciales / atg_total_genoma) * 100) }}% reales
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ATG No Funcionales</div>
                            <div class="stat-value" style="color: var(--accent);">{{ "{:,}".format(atg_total_genoma - atg_stats.total_en_cds) }}</div>
                            <div class="stat-subtext">Por azar estad√≠stico</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-stop-circle"></i> Tripletes STOP</h2>
                    
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">TAA</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_genoma.TAA) }}</div>
                            <div class="stat-subtext">{{ "%.2f"|format(stop_props_genoma.TAA) }}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">TAG</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_genoma.TAG) }}</div>
                            <div class="stat-subtext">{{ "%.2f"|format(stop_props_genoma.TAG) }}%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">TGA</div>
                            <div class="stat-value">{{ "{:,}".format(codones_stop_genoma.TGA) }}</div>
                            <div class="stat-subtext">{{ "%.2f"|format(stop_props_genoma.TGA) }}%</div>
                        </div>
                    </div>

                    <div class="alert-box" style="margin-top: 30px;">
                        <h3><i class="fas fa-balance-scale"></i> Comparaci√≥n</h3>
                        <p style="font-size: 1.1em; line-height: 2;">
                            <strong>Total genoma:</strong> {{ "{:,}".format(codones_stop_genoma.TAA + codones_stop_genoma.TAG + codones_stop_genoma.TGA) }}<br>
                            <strong>Funcionales (CDS):</strong> {{ "{:,}".format(codones_stop_cds.TAA + codones_stop_cds.TAG + codones_stop_cds.TGA) }}<br>
                            <strong>% funcional:</strong> {{ "%.2f"|format(((codones_stop_cds.TAA + codones_stop_cds.TAG + codones_stop_cds.TGA) / (codones_stop_genoma.TAA + codones_stop_genoma.TAG + codones_stop_genoma.TGA)) * 100) }}%
                        </p>
                    </div>
                </div>
            </div>

            <!-- GR√ÅFICOS -->
            <div id="graficos" class="section">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Gr√°ficos
                </h2>
                <div class="card">
                    <div class="chart-grid">
                        <div class="chart-container">
                            <canvas id="chartComparacion"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartProporciones"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VALIDACI√ìN -->
            <div id="validacion" class="section">
                <h2 class="section-title"><i class="fas fa-check-circle"></i> Validaci√≥n</h2>
                <div class="card">
                    <h2>Validaci√≥n con Literatura</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Par√°metro</th>
                                    <th>Obtenido</th>
                                    <th>Esperado</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Longitud</td>
                                    <td>{{ "{:,}".format(validacion.longitud_valor) }} pb</td>
                                    <td>{{ validacion.longitud_esperado }}</td>
                                    <td>
                                        {% if validacion.longitud_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>GC</td>
                                    <td>{{ validacion.gc_valor }}%</td>
                                    <td>{{ validacion.gc_esperado }}</td>
                                    <td>
                                        {% if validacion.gc_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Genes</td>
                                    <td>{{ "{:,}".format(validacion.genes_valor) }}</td>
                                    <td>{{ validacion.genes_esperado }}</td>
                                    <td>
                                        {% if validacion.genes_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>TAA</td>
                                    <td>{{ validacion.taa_valor }}%</td>
                                    <td>{{ validacion.taa_esperado }}</td>
                                    <td>
                                        {% if validacion.taa_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>TAG</td>
                                    <td>{{ validacion.tag_valor }}%</td>
                                    <td>{{ validacion.tag_esperado }}</td>
                                    <td>
                                        {% if validacion.tag_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>TGA</td>
                                    <td>{{ validacion.tga_valor }}%</td>
                                    <td>{{ validacion.tga_esperado }}</td>
                                    <td>
                                        {% if validacion.tga_ok %}
                                        <span class="validation-ok">‚úì Correcto</span>
                                        {% else %}
                                        <span class="validation-warning">‚ö† Fuera</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- COMPACTACI√ìN -->
            <div id="compactacion" class="section">
                <h2 class="section-title"><i class="fas fa-compress"></i> Compactaci√≥n</h2>
                <div class="card">
                    <h2>Compactaci√≥n G√©nica</h2>
                    <div class="stat-box">
                        <div class="stat-item">
                            <div class="stat-label">% Codificante</div>
                            <div class="stat-value">{{ "%.2f"|format(compactacion.porcentaje_compactacion) }}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ compactacion.porcentaje_compactacion }}%">
                                    {{ "%.1f"|format(compactacion.porcentaje_compactacion) }}%
                                </div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Codificante</div>
                            <div class="stat-value">{{ "{:,}".format(compactacion.longitud_codificante) }}</div>
                            <div class="stat-subtext">pb</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">No Codificante</div>
                            <div class="stat-value">{{ "{:,}".format(compactacion.longitud_no_codificante) }}</div>
                            <div class="stat-subtext">pb</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GENES CON BOT√ìN VER -->
            <div id="genes" class="section">
                <h2 class="section-title"><i class="fas fa-microscope"></i> Genes Detallados</h2>
                <div class="card">
                    <h2><i class="fas fa-dna"></i> Explorador de Genes</h2>
                    <input type="text" id="search-genes" placeholder="üîç Buscar gen o producto..." 
                           onkeyup="buscarGenes()" 
                           style="padding: 14px 20px; background: rgba(0,240,255,0.1); border: 2px solid var(--primary); 
                                  border-radius: 10px; color: #fff; width: 100%; margin-bottom: 25px; font-size: 1.05em;">
                    <div id="genes-results" class="loading">Cargando genes...</div>
                </div>
            </div>

            <!-- ESPACIOS -->
            <div id="espacios" class="section">
                <h2 class="section-title"><i class="fas fa-ban"></i> Espacios Interg√©nicos</h2>
                <div class="card">
                    <h2>Regiones No Codificantes</h2>
                    {% for espacio in espacios %}
                    <div class="diferencia-item" style="border-left-color: var(--warning);">
                        <strong style="color: var(--primary);">{{ espacio.entre_genes }}</strong><br>
                        <span style="color: #aaa;">Tama√±o: {{ "{:,}".format(espacio.tama√±o) }} pb | GC: {{ "%.2f"|format(espacio.contenido_gc) }}%</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- COMPARATIVA INTERACTIVA -->
            <div id="comparativa" class="section">
                <h2 class="section-title"><i class="fas fa-balance-scale"></i> Comparativa Interactiva de Genomas</h2>
                
                <div class="card">
                    <h2><i class="fas fa-dna"></i> Comparar Genomas de E. coli</h2>
                    <p style="color: var(--secondary); margin-bottom: 25px; font-size: 1.1em;">
                        Selecciona 2 cepas diferentes y analiza sus diferencias a nivel de codones
                    </p>

                    <div class="selector-container">
                        <div class="selector-item">
                            <label>Genoma 1:</label>
                            <select id="genoma1-select">
                                <option value="">Cargando genomas...</option>
                            </select>
                        </div>

                        <div style="color: var(--primary); font-size: 2.5em; font-weight: bold;">‚Üî</div>

                        <div class="selector-item">
                            <label>Genoma 2:</label>
                            <select id="genoma2-select">
                                <option value="">Cargando genomas...</option>
                            </select>
                        </div>

                        <button class="comparar-btn" onclick="compararGenomas()">
                            <i class="fas fa-chart-bar"></i> COMPARAR
                        </button>
                    </div>

                    <div id="comparativa-loading" class="loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Analizando genomas y calculando diferencias...
                    </div>

                    <div id="comparativa-result" style="display: none;">
                        <!-- RESUMEN DE DIFERENCIAS -->
                        <div style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 107, 107, 0.05)); 
                                    border: 2px solid var(--accent); border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                            <h3 style="color: var(--accent); margin-bottom: 20px;">
                                <i class="fas fa-chart-pie"></i> Resumen de Diferencias
                            </h3>
                            <div id="resumen-diferencias"></div>
                        </div>

                        <!-- GENOMAS LADO A LADO -->
                        <h3 style="color: var(--primary); margin: 35px 0 20px 0;">
                            <i class="fas fa-microscope"></i> Informaci√≥n de Genomas
                        </h3>
                        <div class="comparativa-container" id="genomas-info"></div>

                        <!-- DIFERENCIAS CODON POR CODON -->
                        <div style="margin-top: 40px;">
                            <h3 style="color: var(--primary); margin-bottom: 20px;">
                                <i class="fas fa-dna"></i> Top 30 Diferencias en Codones
                            </h3>
                            <p style="color: var(--secondary); margin-bottom: 20px;">
                                Codones que m√°s var√≠an entre las 2 cepas seleccionadas
                            </p>
                            <div id="diferencias-codones"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <footer>
            <p><strong>Proyecto de Bioinform√°tica</strong></p>
            <p>Universidad Nacional San Antonio Abad del Cusco</p>
            <p style="margin-top: 15px; font-size: 0.9em;">Python | Flask | BioPython | Chart.js</p>
            <p style="margin-top: 10px; color: var(--secondary);">Versi√≥n 2.0 - Con Comparativa Interactiva y Detalles de Genes</p>
        </footer>
    </main>
</div>

<!-- MODAL PARA DETALLES DE GEN -->
<div id="genModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="cerrarModal()">
            <i class="fas fa-times"></i> Cerrar
        </button>
        <div id="genModalContent"></div>
    </div>
</div>

<script>
    // ========================================
    // FUNCIONES GENERALES
    // ========================================
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        sidebar.classList.toggle('visible');
        sidebar.classList.toggle('hidden');
        mainContent.classList.toggle('expanded');
    }

    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.target.closest('.nav-item').classList.add('active');
        
        if (sectionId === 'graficos') cargarGraficos();
        if (sectionId === 'genes') buscarGenes();
        if (sectionId === 'comparativa') cargarGenomosDisponibles();
        
        if (window.innerWidth <= 1024) {
            toggleSidebar();
        }
    }

    // ========================================
    // GR√ÅFICOS
    // ========================================
    async function cargarGraficos() {
        try {
            const response = await fetch('/api/datos-graficos');
            const data = await response.json();
            
            const ctx1 = document.getElementById('chartComparacion');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: data.comparacion.labels,
                        datasets: [{
                            label: 'CDS (Correcto)',
                            data: data.comparacion.cds,
                            backgroundColor: 'rgba(0, 240, 255, 0.7)',
                            borderColor: 'rgba(0, 240, 255, 1)',
                            borderWidth: 2
                        }, {
                            label: 'Genoma Completo',
                            data: data.comparacion.genoma,
                            backgroundColor: 'rgba(255, 107, 107, 0.7)',
                            borderColor: 'rgba(255, 107, 107, 1)',
                            borderWidth: 2
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#e0e0ff' } }
                        },
                        scales: {
                            y: { ticks: { color: '#e0e0ff' }, grid: { color: 'rgba(0,240,255,0.1)' } },
                            x: { ticks: { color: '#e0e0ff' }, grid: { color: 'rgba(0,240,255,0.1)' } }
                        }
                    }
                });
            }

            const ctx2 = document.getElementById('chartProporciones');
            if (ctx2) {
                new Chart(ctx2, {
                    type: 'pie',
                    data: {
                        labels: ['TAA', 'TAG', 'TGA'],
                        datasets: [{
                            data: [data.proporciones_stop.TAA, data.proporciones_stop.TAG, data.proporciones_stop.TGA],
                            backgroundColor: ['rgba(0,240,255,0.8)', 'rgba(255,107,107,0.8)', 'rgba(125,249,255,0.8)'],
                            borderColor: ['rgba(0,240,255,1)', 'rgba(255,107,107,1)', 'rgba(125,249,255,1)'],
                            borderWidth: 2
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#e0e0ff' } }
                        }
                    }
                });
            }
        } catch (e) {
            console.error('Error cargando gr√°ficos:', e);
        }
    }

    // ========================================
    // GENES CON BOT√ìN VER
    // ========================================
    async function buscarGenes() {
        const search = document.getElementById('search-genes')?.value || '';
        try {
            const response = await fetch(`/api/genes?search=${encodeURIComponent(search)}`);
            const data = await response.json();

            let html = `<div class="table-wrapper"><table>
                <thead><tr><th>#</th><th>Gen</th><th>Producto</th><th>Longitud</th><th>Acci√≥n</th></tr></thead>
                <tbody>`;

            data.genes.slice(0, 50).forEach((gen, idx) => {
                html += `<tr>
                    <td><span class="badge">${idx + 1}</span></td>
                    <td><strong style="color: var(--primary);">${gen.gen}</strong></td>
                    <td>${gen.producto.substring(0, 60)}...</td>
                    <td>${gen.longitud.toLocaleString()} pb</td>
                    <td>
                        <button class="btn-ver-gen" onclick="mostrarDetallesGen(${gen.id})">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </td>
                </tr>`;
            });

            html += `</tbody></table></div>`;
            html += `<p style="color: #aaa; margin-top: 20px; text-align: center;">
                        Mostrando ${Math.min(data.genes.length, 50)} de ${data.total} genes
                     </p>`;
            document.getElementById('genes-results').innerHTML = html;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('genes-results').innerHTML = 
                '<p style="color: var(--accent); text-align: center;"><i class="fas fa-exclamation-triangle"></i> Error cargando genes</p>';
        }
    }

    async function mostrarDetallesGen(genId) {
        try {
            const response = await fetch(`/api/gen/${genId}`);
            const data = await response.json();

            let html = `
                <div class="gen-detalle">
                    <div class="gen-titulo">
                        <i class="fas fa-dna"></i> ${data.gen.gen}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div>
                            <strong style="color: var(--secondary);">Producto:</strong><br>
                            <span style="color: #e0e0ff;">${data.gen.producto}</span>
                        </div>
                        <div>
                            <strong style="color: var(--secondary);">ID Prote√≠na:</strong><br>
                            <span style="color: #e0e0ff;">${data.gen.id_proteina}</span>
                        </div>
                        <div>
                            <strong style="color: var(--secondary);">Longitud:</strong><br>
                            <span style="color: var(--primary); font-size: 1.3em; font-weight: bold;">${data.gen.longitud.toLocaleString()} pb</span>
                        </div>
                        <div>
                            <strong style="color: var(--secondary);">Contenido GC:</strong><br>
                            <span style="color: var(--primary); font-size: 1.3em; font-weight: bold;">${data.gen.gc_gen.toFixed(2)}%</span>
                        </div>
                        <div>
                            <strong style="color: var(--secondary);">Posici√≥n:</strong><br>
                            <span style="color: #e0e0ff;">${data.gen.inicio.toLocaleString()} - ${data.gen.fin.toLocaleString()}</span>
                        </div>
                    </div>

                    <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 15px;">
                        <i class="fas fa-flask"></i> S√≠ntesis de Prote√≠na
                    </h3>
                    <p><strong style="color: var(--secondary);">Secuencia de Prote√≠na (${data.tama√±o_proteina} amino√°cidos):</strong></p>
                    <div style="font-family: monospace; background: rgba(0,240,255,0.08); padding: 20px; border-radius: 10px; 
                                word-break: break-all; max-height: 200px; overflow-y: auto; border: 2px solid var(--border); 
                                color: var(--secondary); line-height: 1.8; margin-top: 10px;">
                        ${data.proteina_sintesis}
                    </div>

                    <h3 style="color: var(--primary); margin-top: 30px; margin-bottom: 15px;">
                        <i class="fas fa-chart-bar"></i> Top 12 Codones en este Gen
                    </h3>
                    <div class="codones-grid">
            `;

            const topCodones = Object.entries(data.codones_frecuentes).slice(0, 12);
            topCodones.forEach(([codon, count]) => {
                html += `
                    <div class="codon-item">
                        <div class="codon-label">${codon}</div>
                        <div class="codon-count">${count}x</div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            document.getElementById('genModalContent').innerHTML = html;
            document.getElementById('genModal').classList.add('show');
        } catch (error) {
            console.error('Error:', error);
            alert('Error al cargar detalles del gen');
        }
    }

    function cerrarModal() {
        document.getElementById('genModal').classList.remove('show');
    }

    // Cerrar modal clickeando afuera
    window.onclick = function(event) {
        const modal = document.getElementById('genModal');
        if (event.target === modal) {
            cerrarModal();
        }
    }

    // ========================================
    // COMPARATIVA INTERACTIVA
    // ========================================
    async function cargarGenomosDisponibles() {
        try {
            const response = await fetch('/api/genomas-disponibles');
            const data = await response.json();
            
            const select1 = document.getElementById('genoma1-select');
            const select2 = document.getElementById('genoma2-select');
            
            select1.innerHTML = '';
            select2.innerHTML = '';
            
            data.genomas.forEach((genoma, idx) => {
                const opt1 = document.createElement('option');
                opt1.value = genoma;
                opt1.textContent = genoma;
                select1.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = genoma;
                opt2.textContent = genoma;
                select2.appendChild(opt2);
            });
            
            // Pre-seleccionar distintos por defecto
            if (data.genomas.length >= 2) {
                select1.value = data.genomas[0];
                select2.value = data.genomas[1];
            }
        } catch (error) {
            console.error('Error cargando genomas:', error);
        }
    }

    async function compararGenomas() {
        const genoma1 = document.getElementById('genoma1-select').value;
        const genoma2 = document.getElementById('genoma2-select').value;
        
        if (!genoma1 || !genoma2) {
            alert('‚ö†Ô∏è Selecciona 2 genomas para comparar');
            return;
        }
        
        if (genoma1 === genoma2) {
            alert('‚ö†Ô∏è Selecciona 2 genomas diferentes');
            return;
        }
        
        document.getElementById('comparativa-loading').style.display = 'block';
        document.getElementById('comparativa-result').style.display = 'none';
        
        try {
            const response = await fetch(`/api/comparar-genomas?genoma1=${encodeURIComponent(genoma1)}&genoma2=${encodeURIComponent(genoma2)}`);
            const data = await response.json();
            
            mostrarComparativa(data);
            document.getElementById('comparativa-loading').style.display = 'none';
            document.getElementById('comparativa-result').style.display = 'block';
        } catch (error) {
            console.error('Error:', error);
            alert('‚ùå Error al comparar genomas');
            document.getElementById('comparativa-loading').style.display = 'none';
        }
    }

    function mostrarComparativa(data) {
        // Resumen de diferencias
        const resumen = data.resumen_diferencias;
        let resumenHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
                <div style="background: rgba(0,240,255,0.1); padding: 20px; border-radius: 12px; border: 2px solid var(--border);">
                    <strong style="color: var(--secondary); font-size: 0.9em;">Diferencia de Longitud:</strong><br>
                    <span style="color: var(--primary); font-size: 1.5em; font-weight: bold;">
                        ¬± ${resumen.diferencia_longitud.toLocaleString()} pb
                    </span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 20px; border-radius: 12px; border: 2px solid var(--border);">
                    <strong style="color: var(--secondary); font-size: 0.9em;">Diferencia de Genes:</strong><br>
                    <span style="color: var(--primary); font-size: 1.5em; font-weight: bold;">
                        ¬± ${resumen.diferencia_genes} genes
                    </span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 20px; border-radius: 12px; border: 2px solid var(--border);">
                    <strong style="color: var(--secondary); font-size: 0.9em;">Diferencia GC:</strong><br>
                    <span style="color: var(--primary); font-size: 1.5em; font-weight: bold;">
                        ¬± ${resumen.diferencia_gc.toFixed(2)}%
                    </span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 20px; border-radius: 12px; border: 2px solid var(--border);">
                    <strong style="color: var(--secondary); font-size: 0.9em;">Codones Diferentes:</strong><br>
                    <span style="color: var(--primary); font-size: 1.5em; font-weight: bold;">
                        ${resumen.codones_diferentes} de ${resumen.total_codones}
                    </span>
                </div>
            </div>
        `;
        document.getElementById('resumen-diferencias').innerHTML = resumenHTML;

        // Genomas lado a lado
        let genomas_html = '';
        
        ['genoma1', 'genoma2'].forEach(key => {
            const g = data[key];
            genomas_html += `
                <div class="genoma-card">
                    <div class="genoma-titulo">
                        <i class="fas fa-dna"></i> ${g.nombre}
                    </div>
                    <div class="stat-row">
                        <strong>Longitud:</strong>
                        <span>${(g.longitud / 1_000_000).toFixed(2)} Mb</span>
                    </div>
                    <div class="stat-row">
                        <strong>Genes:</strong>
                        <span>${g.num_genes.toLocaleString()}</span>
                    </div>
                    <div class="stat-row">
                        <strong>Contenido GC:</strong>
                        <span>${g.gc.toFixed(2)}%</span>
                    </div>
                    <div class="stat-row">
                        <strong>Compactaci√≥n:</strong>
                        <span>${g.compactacion.toFixed(2)}%</span>
                    </div>
                </div>
            `;
        });
        
        document.getElementById('genomas-info').innerHTML = genomas_html;

        // Diferencias codon por codon
        let diferencias_html = '';
        
        data.diferencias_codones.forEach((diff, idx) => {
            const dir = diff.diferencia > 0 ? '‚Üë' : '‚Üì';
            const color = diff.diferencia > 0 ? 'var(--secondary)' : '#ff9999';
            
            diferencias_html += `
                <div class="diferencia-item">
                    <div class="diferencia-header">
                        <span class="codon-badge">${diff.codon}</span>
                        <span style="color: ${color}; font-weight: bold; font-size: 1.4em;">
                            ${dir} ${Math.abs(diff.diferencia).toLocaleString()}
                        </span>
                    </div>
                    <div class="diferencia-valor">
                        <div class="valor-genoma">
                            <strong>${data.genoma1.nombre}:</strong><br>
                            <span style="color: var(--primary); font-size: 1.3em;">${diff[data.genoma1.nombre].toLocaleString()}</span>
                        </div>
                        <span class="flecha-diferencia">‚Üí</span>
                        <div class="valor-genoma">
                            <strong>${data.genoma2.nombre}:</strong><br>
                            <span style="color: var(--primary); font-size: 1.3em;">${diff[data.genoma2.nombre].toLocaleString()}</span>
                        </div>
                    </div>
                    <p style="color: var(--secondary); font-size: 0.95em; margin-top: 12px;">
                        Cambio: ${diff.porcentaje_diff.toFixed(1)}%
                    </p>
                </div>
            `;
        });
        
        document.getElementById('diferencias-codones').innerHTML = diferencias_html;
    }

    // ========================================
    // INICIALIZACI√ìN
    // ========================================
    if (window.innerWidth <= 1024) {
        document.getElementById('sidebar').classList.add('hidden');
        document.getElementById('mainContent').classList.add('expanded');
    }

    window.addEventListener('load', () => {
        cargarGraficos();
        buscarGenes();
    });
</script>

</body>
</html>
