<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Gen√≥mico Interactivo - E. coli</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(circle at top, #050012, #000);
            color: #e0e0ff;
            font-family: "Segoe UI", sans-serif;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid #00f0ff;
        }

        h1 {
            font-size: 2.5em;
            text-shadow: 0 0 15px #00f0ff;
            color: #00f0ff;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7df9ff;
            font-size: 1.1em;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            border-bottom: 2px solid #00f0ff33;
            padding-bottom: 15px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(10, 10, 40, 0.6);
            border: 1px solid #00f0ff;
            color: #00f0ff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .tab-btn:hover {
            background: #00f0ff22;
            transform: translateY(-3px);
        }

        .tab-btn.active {
            background: #00f0ff;
            color: #000;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CARDS */
        .card {
            background: rgba(10, 10, 40, 0.8);
            border: 1px solid #00f0ff;
            box-shadow: 0 0 20px #00f0ff55;
            border-radius: 14px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.4s ease;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 45px #00f0ffcc;
        }

        .card h2 {
            color: #00f0ff;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-shadow: 0 0 10px #00f0ff;
        }

        .stat-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(0, 240, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #00f0ff;
        }

        .stat-label {
            color: #7df9ff;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8em;
            color: #00f0ff;
            font-weight: bold;
        }

        /* SELECTORS */
        select {
            padding: 12px 16px;
            background: rgba(10, 10, 40, 0.9);
            border: 2px solid #00f0ff;
            border-radius: 8px;
            color: #e0e0ff;
            font-size: 1em;
            cursor: pointer;
            margin: 10px 5px;
        }

        select:focus {
            outline: none;
            box-shadow: 0 0 15px #00f0ff;
        }

        .selector-container {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 240, 255, 0.05);
            border-radius: 10px;
        }

        .selector-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .comparar-btn {
            padding: 12px 32px;
            background: linear-gradient(135deg, #00f0ff, #7df9ff);
            border: none;
            color: #000;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .comparar-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #00f0ff;
        }

        /* TABLA INTERACTIVA */
        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #00f0ff33;
        }

        th {
            background: #00f0ff22;
            color: #00f0ff;
            font-weight: bold;
        }

        tr:hover {
            background: #00f0ff11;
        }

        /* COMPARATIVA LADO A LADO */
        .comparativa-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .genoma-card {
            background: rgba(0, 240, 255, 0.08);
            border: 2px solid #00f0ff;
            padding: 20px;
            border-radius: 10px;
        }

        .genoma-titulo {
            color: #00f0ff;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #00f0ff33;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #00f0ff22;
        }

        .stat-row strong {
            color: #7df9ff;
        }

        /* DIFERENCIAS */
        .diferencias-container {
            margin-top: 30px;
        }

        .diferencia-item {
            background: rgba(10, 40, 40, 0.5);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }

        .diferencia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .codon-badge {
            background: #00f0ff;
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-family: monospace;
        }

        .diferencia-valor {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .valor-genoma {
            background: rgba(0, 240, 255, 0.1);
            padding: 10px 20px;
            border-radius: 6px;
            border: 1px solid #00f0ff33;
        }

        .valor-genoma strong {
            color: #7df9ff;
        }

        .flecha-diferencia {
            color: #ff6b6b;
            font-size: 1.5em;
            font-weight: bold;
        }

        .loading {
            color: #7df9ff;
            font-style: italic;
            padding: 20px;
            text-align: center;
        }

        /* GR√ÅFICOS */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        .badge {
            display: inline-block;
            background: #00f0ff;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 10px;
        }

        /* BADGES CODONES STOP */
        .codon-badge {
            display: inline-block;
            background: #00f0ff;
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1em;
        }

        .codon-badge-tag {
            display: inline-block;
            background: #7df9ff;
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1em;
        }

        .codon-badge-tga {
            display: inline-block;
            background: #ff6b6b;
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-family: monospace;
            font-size: 1.1em;
        }

        /* DETALLES GEN */
        .gen-detalle {
            background: rgba(0, 240, 255, 0.08);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid #00f0ff33;
        }

        .gen-titulo {
            color: #00f0ff;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: bold;
            padding-bottom: 10px;
            border-bottom: 2px solid #00f0ff33;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .comparativa-container { grid-template-columns: 1fr; }
            .selector-container { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üß¨ An√°lisis Gen√≥mico Interactivo</h1>
        <p class="subtitle"><i>Escherichia coli</i> - Exploraci√≥n detallada y comparativa de genomas</p>
    </header>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('resumen')">üìä Resumen General</button>
        <button class="tab-btn" onclick="switchTab('genes')">üß¨ Genes Detallados</button>
        <button class="tab-btn" onclick="switchTab('compactacion')">üì¶ Compactaci√≥n G√©nica</button>
        <button class="tab-btn" onclick="switchTab('espacios')">üö´ Espacios Basura</button>
        <button class="tab-btn" onclick="switchTab('comparativa')">‚öñÔ∏è Comparativa Interactiva</button>
        <button class="tab-btn" onclick="switchTab('codones')">üî¨ An√°lisis Codones</button>
    </div>

    <!-- TAB: COMPARATIVA INTERACTIVA -->
    <div id="comparativa" class="tab-content">
        <div class="card">
            <h2>‚öñÔ∏è Comparativa Interactiva de Genomas</h2>
            <p style="margin-bottom: 20px; color: #7df9ff;">
                Selecciona 2 cepas de E. coli y ver√°s EXACTAMENTE d√≥nde difieren a nivel codon
            </p>

            <div class="selector-container">
                <div class="selector-item">
                    <label style="color: #7df9ff; font-weight: bold;">Genoma 1:</label>
                    <select id="genoma1-select">
                        <option value="">Cargando genomas...</option>
                    </select>
                </div>

                <div style="color: #00f0ff; font-size: 2em; font-weight: bold;">‚Üî</div>

                <div class="selector-item">
                    <label style="color: #7df9ff; font-weight: bold;">Genoma 2:</label>
                    <select id="genoma2-select">
                        <option value="">Cargando genomas...</option>
                    </select>
                </div>

                <button class="comparar-btn" onclick="compararGenomas()">üîç COMPARAR</button>
            </div>

            <div id="comparativa-loading" class="loading" style="display: none;">
                ‚è≥ Analizando genomas y calculando diferencias...
            </div>

            <div id="comparativa-result" style="display: none;">
                <!-- RESUMEN DE DIFERENCIAS -->
                <div style="background: rgba(255, 107, 107, 0.1); border: 2px solid #ff6b6b; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #ff6b6b; margin-bottom: 15px;">üìä Resumen de Diferencias</h3>
                    <div id="resumen-diferencias"></div>
                </div>

                <!-- GENOMAS LADO A LADO -->
                <h3 style="color: #00f0ff; margin: 25px 0 15px 0;">üìã Informaci√≥n de Genomas</h3>
                <div class="comparativa-container" id="genomas-info"></div>

                <!-- DIFERENCIAS CODON POR CODON -->
                <div class="diferencias-container">
                    <h3 style="color: #00f0ff; margin: 25px 0 15px 0;">üß¨ Top 30 Diferencias en Codones</h3>
                    <p style="color: #7df9ff; margin-bottom: 15px;">
                        Mostrando los codones que m√°s var√≠an entre las 2 cepas seleccionadas
                    </p>
                    <div id="diferencias-codones"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: RESUMEN GENERAL -->
    <div id="resumen" class="tab-content active">
        <div class="card">
            <h2>üìä Informaci√≥n General del Genoma</h2>
            <div class="stat-box">
                <div class="stat-item">
                    <div class="stat-label">Longitud Total del Genoma</div>
                    <div class="stat-value" id="genome-length">{{ genome_length }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Contenido GC</div>
                    <div class="stat-value" id="gc-content">{{ "%.2f"|format(gc) }}%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total de Genes (CDS)</div>
                    <div class="stat-value" id="total-genes">{{ num_genes }}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Densidad G√©nica</div>
                    <div class="stat-value" id="gene-density">{{ "%.2f"|format(gene_density) }} genes/Mb</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üèÜ Genes Extremos</h2>
            <div class="stat-box">
                <div class="stat-item">
                    <div class="stat-label">Gen m√°s GRANDE</div>
                    <div class="stat-value" style="color: #ff6b6b;">{{ gen_mas_grande.gen }}</div>
                    <p style="color: #7df9ff; margin-top: 8px;"><strong>Producto:</strong> {{ gen_mas_grande.producto }}</p>
                    <p style="color: #7df9ff;"><strong>Longitud:</strong> {{ gen_mas_grande.longitud }} pb</p>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gen m√°s PEQUE√ëO</div>
                    <div class="stat-value" style="color: #7df9ff;">{{ gen_mas_pequeno.gen }}</div>
                    <p style="color: #7df9ff; margin-top: 8px;"><strong>Producto:</strong> {{ gen_mas_pequeno.producto }}</p>
                    <p style="color: #7df9ff;"><strong>Longitud:</strong> {{ gen_mas_pequeno.longitud }} pb</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìà Top 15 Genes m√°s Grandes</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Rango</th>
                            <th>Gen</th>
                            <th>Producto</th>
                            <th>Longitud (pb)</th>
                            <th>Contenido GC (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set counter = [0] %}
                        {% for gen in top_genes %}
                            {% if counter.append(counter.pop() + 1) %}{% endif %}
                        <tr>
                            <td><span class="badge">{{ counter[0] }}</span></td>
                            <td><strong>{{ gen.gen }}</strong></td>
                            <td>{{ gen.producto[:50] }}</td>
                            <td>{{ gen.longitud }}</td>
                            <td>{{ "%.2f"|format(gen.gc_gen) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- TAB: GENES DETALLADOS -->
    <div id="genes" class="tab-content">
        <div class="card">
            <h2>üîç Explorador de Genes</h2>
            <input type="text" class="search-box" id="search-genes" placeholder="Buscar gen por nombre o producto..." onkeyup="buscarGenes()" style="padding: 12px 16px; background: rgba(10, 10, 40, 0.9); border: 1px solid #00f0ff; border-radius: 8px; color: #e0e0ff; margin-bottom: 20px; font-size: 1em; width: 100%;">
            <div id="genes-results" class="loading">Cargando genes...</div>
        </div>
    </div>

    <!-- MODAL para detalles de gen -->
    <div id="genModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
        <div style="background: rgba(10,10,40,0.95); margin: 20px auto; max-width: 900px; padding: 30px; border-radius: 14px; border: 1px solid #00f0ff;">
            <button onclick="cerrarModal()" style="float: right; background: #ff6b6b; border: none; color: white; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold;">‚úï Cerrar</button>
            <div id="genModalContent"></div>
        </div>
    </div>

    <!-- TAB: COMPACTACI√ìN -->
    <div id="compactacion" class="tab-content">
        <div class="card">
            <h2>üì¶ Compactaci√≥n G√©nica</h2>
            <div class="stat-box">
                <div class="stat-item">
                    <div class="stat-label">Porcentaje Codificante</div>
                    <div class="stat-value" style="color: #7df9ff;">{{ "%.2f"|format(compactacion.porcentaje_compactacion) }}%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Longitud Codificante</div>
                    <div class="stat-value">{{ compactacion.longitud_codificante }} pb</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Secuencias No Codificantes</div>
                    <div class="stat-value">{{ compactacion.longitud_total - compactacion.longitud_codificante }} pb</div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: ESPACIOS BASURA -->
    <div id="espacios" class="tab-content">
        <div class="card">
            <h2>üö´ Espacios Interg√©nicos (DNA Basura)</h2>
            <h3 style="color: #00f0ff; margin: 20px 0;">Top 15 Espacios m√°s Grandes</h3>
            {% for espacio in espacios %}
            <div class="diferencia-item">
                <strong>{{ espacio.entre_genes }}</strong> | Posici√≥n: {{ espacio.posicion }}
                <p style="margin-top: 8px; color: #e0e0ff;">
                    <strong>Tama√±o:</strong> {{ espacio.tama√±o }} pb | 
                    <strong>Contenido GC:</strong> {{ "%.2f"|format(espacio.contenido_gc) }}%
                </p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- TAB: CODONES DE TERMINACI√ìN -->
    <div id="codones" class="tab-content">
        <div class="card">
            <h2>üõë An√°lisis Detallado de Codones de Terminaci√≥n</h2>
            <p style="margin-bottom: 20px; color: #7df9ff;">
                Los codones de terminaci√≥n (STOP) se√±alan el fin de la traducci√≥n proteica. Este an√°lisis cuantifica su distribuci√≥n 
                y compara con preferencias reportadas en literatura cient√≠fica.
            </p>

            <!-- TABS PARA DOS AN√ÅLISIS -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #00f0ff33; padding-bottom: 10px;">
                <button onclick="mostrarAnalisisStop('terminadores')" id="btn-term" style="padding: 10px 20px; background: #00f0ff; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    üß¨ Terminadores de Genes (~4318)
                </button>
                <button onclick="mostrarAnalisisStop('totales')" id="btn-total" style="padding: 10px 20px; background: rgba(10, 10, 40, 0.6); border: 1px solid #00f0ff; color: #00f0ff; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    üìä Tripletes Totales (~179644)
                </button>
            </div>

            <div id="contenido-terminadores" style="display: block;">
            <!-- TABLA CUANTITATIVA - TERMINADORES -->
            <h3 style="color: #00f0ff; margin: 25px 0 15px 0;">üìä Cuantificaci√≥n de Codones STOP (Como Terminadores)</h3>
            <p style="color: #7df9ff; margin-bottom: 15px; font-size: 0.9em;">
                <strong>Definici√≥n:</strong> Cuenta SOLO los codones STOP que aparecen al final de cada gen (√∫ltima posici√≥n de codificaci√≥n).
                Este es el n√∫mero real de genes terminados por cada tipo de cod√≥n STOP.
            </p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Cod√≥n</th>
                            <th>Secuencia</th>
                            <th id="header-term">Terminadores (Final de Gene)</th>
                            <th id="header-pct-term">Porcentaje (%)</th>
                            <th>Proporci√≥n Relativa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="codon-badge">TAA</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TAA (√Åmbar mutante)</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-taa-term">{{ stop_codons_terminadores.TAA }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-taa-term">{{ "%.2f"|format(stop_props_terminadores.TAA) }}%</strong></td>
                            <td>
                                <div style="background: rgba(0, 240, 255, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #00f0ff, #7df9ff); width: {{ stop_props_terminadores.TAA * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">1 : {{ (stop_codons_terminadores.TAG / stop_codons_terminadores.TAA)|round(2) if stop_codons_terminadores.TAA > 0 else 0 }} : {{ (stop_codons_terminadores.TGA / stop_codons_terminadores.TAA)|round(2) if stop_codons_terminadores.TAA > 0 else 0 }}</small>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="codon-badge-tag">TAG</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TAG (√Åmbar)</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-tag-term">{{ stop_codons_terminadores.TAG }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-tag-term">{{ "%.2f"|format(stop_props_terminadores.TAG) }}%</strong></td>
                            <td>
                                <div style="background: rgba(125, 249, 255, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #7df9ff, #00f0ff); width: {{ stop_props_terminadores.TAG * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">{{ (stop_codons_terminadores.TAG / stop_codons_terminadores.TAA)|round(2) if stop_codons_terminadores.TAA > 0 else 0 }} : 1 : {{ (stop_codons_terminadores.TGA / stop_codons_terminadores.TAG)|round(2) if stop_codons_terminadores.TAG > 0 else 0 }}</small>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="codon-badge-tga">TGA</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TGA (√ìpalo)</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-tga-term">{{ stop_codons_terminadores.TGA }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-tga-term">{{ "%.2f"|format(stop_props_terminadores.TGA) }}%</strong></td>
                            <td>
                                <div style="background: rgba(255, 107, 107, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #ff6b6b, #ff9999); width: {{ stop_props_terminadores.TGA * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">{{ (stop_codons_terminadores.TGA / stop_codons_terminadores.TAA)|round(2) if stop_codons_terminadores.TAA > 0 else 0 }} : {{ (stop_codons_terminadores.TGA / stop_codons_terminadores.TAG)|round(2) if stop_codons_terminadores.TAG > 0 else 0 }} : 1</small>
                                </div>
                            </td>
                        </tr>
                        <tr style="background: rgba(0, 240, 255, 0.1); font-weight: bold;">
                            <td colspan="2" style="text-align: right;">TOTAL CODONES STOP:</td>
                            <td style="font-size: 1.2em; color: #00f0ff;" id="total-term">{{ stop_codons_terminadores.TAA + stop_codons_terminadores.TAG + stop_codons_terminadores.TGA }}</td>
                            <td style="font-size: 1.2em; color: #00f0ff;">100.00%</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p style="margin: 20px 0; padding: 15px; background: rgba(0, 240, 255, 0.1); border-left: 3px solid #00f0ff; color: #7df9ff;">
                <strong>Nota:</strong> Este an√°lisis cuenta SOLO los codones STOP que act√∫an como terminadores (al final de genes).
                Aproximadamente <strong>1 codon STOP por gene</strong>, resultando en ~{{ num_genes }} terminadores.
            </p>

            </div>

            <!-- AN√ÅLISIS DE TRIPLETES TOTALES -->
            <div id="contenido-totales" style="display: none;">
            <h3 style="color: #00f0ff; margin: 25px 0 15px 0;">üìä Cuantificaci√≥n de Tripletes TAA/TAG/TGA (TOTALES)</h3>
            <p style="color: #7df9ff; margin-bottom: 15px; font-size: 0.9em;">
                <strong>Definici√≥n:</strong> Cuenta TODOS los tripletes TAA, TAG, TGA que aparecen en el genoma completo,
                incluyendo aquellos dentro de genes (no solo como terminadores). Busca en todos los marcos de lectura.
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Cod√≥n</th>
                            <th>Secuencia</th>
                            <th>Tripletes Totales (Todo el Genoma)</th>
                            <th>Porcentaje (%)</th>
                            <th>Proporci√≥n Relativa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="codon-badge">TAA</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TAA</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-taa-tot">{{ stop_codons_totales.TAA }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-taa-tot">{{ "%.2f"|format(stop_props_totales.TAA) }}%</strong></td>
                            <td>
                                <div style="background: rgba(0, 240, 255, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #00f0ff, #7df9ff); width: {{ stop_props_totales.TAA * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">1 : {{ (stop_codons_totales.TAG / stop_codons_totales.TAA)|round(2) if stop_codons_totales.TAA > 0 else 0 }} : {{ (stop_codons_totales.TGA / stop_codons_totales.TAA)|round(2) if stop_codons_totales.TAA > 0 else 0 }}</small>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="codon-badge-tag">TAG</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TAG</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-tag-tot">{{ stop_codons_totales.TAG }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-tag-tot">{{ "%.2f"|format(stop_props_totales.TAG) }}%</strong></td>
                            <td>
                                <div style="background: rgba(125, 249, 255, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #7df9ff, #00f0ff); width: {{ stop_props_totales.TAG * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">{{ (stop_codons_totales.TAG / stop_codons_totales.TAA)|round(2) if stop_codons_totales.TAA > 0 else 0 }} : 1 : {{ (stop_codons_totales.TGA / stop_codons_totales.TAG)|round(2) if stop_codons_totales.TAG > 0 else 0 }}</small>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><span class="codon-badge-tga">TGA</span></td>
                            <td style="font-family: monospace; font-weight: bold;">TGA</td>
                            <td style="font-size: 1.2em; color: #00f0ff;"><strong id="val-tga-tot">{{ stop_codons_totales.TGA }}</strong></td>
                            <td style="font-size: 1.2em; color: #7df9ff;"><strong id="pct-tga-tot">{{ "%.2f"|format(stop_props_totales.TGA) }}%</strong></td>
                            <td>
                                <div style="background: rgba(255, 107, 107, 0.2); padding: 8px; border-radius: 4px; text-align: center;">
                                    <div style="background: linear-gradient(90deg, #ff6b6b, #ff9999); width: {{ stop_props_totales.TGA * 3.33 }}%; height: 20px; border-radius: 3px; margin: 5px 0;"></div>
                                    <small style="color: #7df9ff;">{{ (stop_codons_totales.TGA / stop_codons_totales.TAA)|round(2) if stop_codons_totales.TAA > 0 else 0 }} : {{ (stop_codons_totales.TGA / stop_codons_totales.TAG)|round(2) if stop_codons_totales.TAG > 0 else 0 }} : 1</small>
                                </div>
                            </td>
                        </tr>
                        <tr style="background: rgba(0, 240, 255, 0.1); font-weight: bold;">
                            <td colspan="2" style="text-align: right;">TOTAL TRIPLETES:</td>
                            <td style="font-size: 1.2em; color: #00f0ff;" id="total-tot">{{ stop_codons_totales.TAA + stop_codons_totales.TAG + stop_codons_totales.TGA }}</td>
                            <td style="font-size: 1.2em; color: #00f0ff;">100.00%</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p style="margin: 20px 0; padding: 15px; background: rgba(255, 107, 107, 0.1); border-left: 3px solid #ff6b6b; color: #7df9ff;">
                <strong>Nota:</strong> Este an√°lisis busca TODOS los tripletes TAA/TAG/TGA en el genoma completo.
                Incluye los dentro de regiones codificantes (otros marcos), regiones interg√©nicas, y cualquier lugar.
                Resultado: ~{{ stop_codons_totales.TAA + stop_codons_totales.TAG + stop_codons_totales.TGA }} tripletes encontrados.
            </p>

            </div>

            <!-- GR√ÅFICO CIRCULAR -->
            <h3 style="color: #00f0ff; margin: 30px 0 15px 0;">üìà Distribuci√≥n Proporcional</h3>
            <div class="chart-container">
                <canvas id="stopCodonChart"></canvas>
            </div>

            <!-- COMPARATIVA CON LITERATURA -->
            <h3 style="color: #00f0ff; margin: 30px 0 15px 0;">üìö Comparativa con Literatura Cient√≠fica</h3>
            <p style="margin-bottom: 15px; color: #7df9ff;">
                Comparaci√≥n de frecuencias observadas vs reportadas en estudios previos de E. coli
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Cod√≥n</th>
                            <th>Tu Genoma (%)</th>
                            <th>Blattner et al. (1997)</th>
                            <th>Genoma Est√°ndar</th>
                            <th>Diferencia</th>
                            <th>Observaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: rgba(0, 240, 255, 0.05);">
                            <td><strong style="color: #00f0ff;">TAA</strong></td>
                            <td style="font-weight: bold; color: #7df9ff;">{{ "%.2f"|format(stop_props.TAA) }}%</td>
                            <td style="color: #e0e0ff;">61.20%</td>
                            <td style="color: #e0e0ff;">~62%</td>
                            <td style="color: {% if stop_props.TAA > 59 and stop_props.TAA < 63 %}#7df9ff{% else %}#ff6b6b{% endif %}; font-weight: bold;">
                                {{ "%+.2f"|format(stop_props.TAA - 61.20) }}%
                            </td>
                            <td style="font-size: 0.9em; color: #7df9ff;">
                                {% if stop_props.TAA > 59 and stop_props.TAA < 63 %}‚úì Dentro del rango esperado{% else %}‚ö† Fuera del rango{% endif %}
                            </td>
                        </tr>
                        <tr style="background: rgba(125, 249, 255, 0.05);">
                            <td><strong style="color: #00f0ff;">TAG</strong></td>
                            <td style="font-weight: bold; color: #7df9ff;">{{ "%.2f"|format(stop_props.TAG) }}%</td>
                            <td style="color: #e0e0ff;">5.49%</td>
                            <td style="color: #e0e0ff;">~5-6%</td>
                            <td style="color: {% if stop_props.TAG > 4 and stop_props.TAG < 7 %}#7df9ff{% else %}#ff6b6b{% endif %}; font-weight: bold;">
                                {{ "%+.2f"|format(stop_props.TAG - 5.49) }}%
                            </td>
                            <td style="font-size: 0.9em; color: #7df9ff;">
                                {% if stop_props.TAG > 4 and stop_props.TAG < 7 %}‚úì Dentro del rango esperado{% else %}‚ö† Fuera del rango{% endif %}
                            </td>
                        </tr>
                        <tr style="background: rgba(255, 107, 107, 0.05);">
                            <td><strong style="color: #00f0ff;">TGA</strong></td>
                            <td style="font-weight: bold; color: #7df9ff;">{{ "%.2f"|format(stop_props.TGA) }}%</td>
                            <td style="color: #e0e0ff;">33.31%</td>
                            <td style="color: #e0e0ff;">~32-34%</td>
                            <td style="color: {% if stop_props.TGA > 31 and stop_props.TGA < 35 %}#7df9ff{% else %}#ff6b6b{% endif %}; font-weight: bold;">
                                {{ "%+.2f"|format(stop_props.TGA - 33.31) }}%
                            </td>
                            <td style="font-size: 0.9em; color: #7df9ff;">
                                {% if stop_props.TGA > 31 and stop_props.TGA < 35 %}‚úì Dentro del rango esperado{% else %}‚ö† Fuera del rango{% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- INTERPRETACI√ìN BIOL√ìGICA -->
            <div style="background: rgba(0, 240, 255, 0.1); border: 2px solid #00f0ff; padding: 20px; border-radius: 10px; margin-top: 25px;">
                <h3 style="color: #00f0ff; margin-bottom: 15px;">üî¨ Interpretaci√≥n Biol√≥gica</h3>
                
                <h4 style="color: #7df9ff; margin-top: 15px; margin-bottom: 10px;">Preferencia de TAA ({{ "%.2f"|format(stop_props.TAA) }}%)</h4>
                <p style="color: #e0e0ff; margin-bottom: 15px;">
                    TAA es el cod√≥n de terminaci√≥n m√°s frecuente en E. coli ({{ stop_codons.TAA }} instancias). 
                    Esta preferencia evolutiva sugiere que TAA fue el primer codon STOP en emerger, siendo reconocido por 
                    factores de liberaci√≥n m√°s ancestrales (RF1/RF3).
                </p>

                <h4 style="color: #7df9ff; margin-top: 15px; margin-bottom: 10px;">Uso de TGA ({{ "%.2f"|format(stop_props.TGA) }}%)</h4>
                <p style="color: #e0e0ff; margin-bottom: 15px;">
                    TGA representa aproximadamente 1/3 de los codones STOP ({{ stop_codons.TGA }} instancias). 
                    Aunque TGA puede codificar selenio bajo ciertas condiciones, aqu√≠ funciona como STOP genuino. 
                    Su prevalencia indica selecci√≥n natural contra su uso como sentido.
                </p>

                <h4 style="color: #7df9ff; margin-top: 15px; margin-bottom: 10px;">Baja Frecuencia de TAG ({{ "%.2f"|format(stop_props.TAG) }}%)</h4>
                <p style="color: #e0e0ff; margin-bottom: 15px;">
                    TAG es el menos usado (solo {{ stop_codons.TAG }} instancias, ~5%). Algunos estudios sugieren 
                    que TAG es reconocido menos eficientemente por RF2 en E. coli, resultando en menor frecuencia de uso. 
                    Esta preferencia evita s√≠ntesis de prote√≠nas aberrantes.
                </p>

                <h4 style="color: #7df9ff; margin-top: 15px; margin-bottom: 10px;">üìå Implicaciones Evolutivas</h4>
                <p style="color: #e0e0ff;">
                    La distribuci√≥n TAA > TGA >> TAG refleja presiones selectivas hist√≥ricas. La baja frecuencia de TAG 
                    sugiere que fue el √∫ltimo codon STOP en adoptarse evolutivamente. Esta preferencia se conserva en 
                    la mayor√≠a de bacterias y est√° asociada con genes esenciales para supervivencia.
                </p>
            </div>

            <!-- TABLA DE DATOS BRUTOS -->
            <h3 style="color: #00f0ff; margin: 30px 0 15px 0;">üìã Datos Brutos para An√°lisis</h3>
            <div style="background: rgba(10, 40, 40, 0.5); padding: 15px; border-radius: 8px; border-left: 3px solid #00f0ff; font-family: monospace;">
                <p><strong>Longitud del genoma:</strong> {{ genome_length }} pb</p>
                <p><strong>N√∫mero total de genes:</strong> {{ num_genes }}</p>
                <p><strong>Total de codones de terminaci√≥n:</strong> {{ stop_codons.TAA + stop_codons.TAG + stop_codons.TGA }}</p>
                <p><strong>Promedio de STOP por gene:</strong> {{ "%.2f"|format((stop_codons.TAA + stop_codons.TAG + stop_codons.TGA) / num_genes) }}</p>
                <p style="margin-top: 15px; color: #7df9ff; border-top: 1px solid #00f0ff33; padding-top: 15px;">
                    <strong>Ratio TAA:TAG:TGA</strong><br>
                    1 : {{ "%.2f"|format(stop_codons.TAG / stop_codons.TAA if stop_codons.TAA > 0 else 0) }} : {{ "%.2f"|format(stop_codons.TGA / stop_codons.TAA if stop_codons.TAA > 0 else 0) }}
                </p>
            </div>
        </div>
    </div>

</div>

<script>
    // Cargar genomas disponibles al iniciar
    async function cargarGenomosDisponibles() {
        try {
            const response = await fetch('/api/genomas-disponibles');
            const data = await response.json();
            
            const select1 = document.getElementById('genoma1-select');
            const select2 = document.getElementById('genoma2-select');
            
            select1.innerHTML = '';
            select2.innerHTML = '';
            
            data.genomas.forEach((genoma, idx) => {
                const opt1 = document.createElement('option');
                opt1.value = genoma;
                opt1.textContent = genoma;
                select1.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = genoma;
                opt2.textContent = genoma;
                select2.appendChild(opt2);
            });
            
            // Pre-seleccionar distintos por defecto
            if (data.genomas.length >= 2) {
                select1.value = data.genomas[0];
                select2.value = data.genomas[1];
            }
        } catch (error) {
            console.error('Error cargando genomas:', error);
        }
    }

    async function compararGenomas() {
        const genoma1 = document.getElementById('genoma1-select').value;
        const genoma2 = document.getElementById('genoma2-select').value;
        
        if (!genoma1 || !genoma2) {
            alert('Selecciona 2 genomas para comparar');
            return;
        }
        
        if (genoma1 === genoma2) {
            alert('Selecciona 2 genomas diferentes');
            return;
        }
        
        document.getElementById('comparativa-loading').style.display = 'block';
        document.getElementById('comparativa-result').style.display = 'none';
        
        try {
            const response = await fetch(`/api/comparar-genomas?genoma1=${encodeURIComponent(genoma1)}&genoma2=${encodeURIComponent(genoma2)}`);
            const data = await response.json();
            
            mostrarComparativa(data);
            document.getElementById('comparativa-loading').style.display = 'none';
            document.getElementById('comparativa-result').style.display = 'block';
        } catch (error) {
            console.error('Error:', error);
            alert('Error al comparar genomas');
        }
    }

    function mostrarComparativa(data) {
        // Resumen de diferencias
        const resumen = data.resumen_diferencias;
        let resumenHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: rgba(0,240,255,0.1); padding: 15px; border-radius: 8px;">
                    <strong style="color: #7df9ff;">Diferencia de Longitud:</strong><br>
                    <span style="color: #00f0ff; font-size: 1.3em;">¬± ${resumen.diferencia_longitud.toLocaleString()} pb</span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 15px; border-radius: 8px;">
                    <strong style="color: #7df9ff;">Diferencia de Genes:</strong><br>
                    <span style="color: #00f0ff; font-size: 1.3em;">¬± ${resumen.diferencia_genes} genes</span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 15px; border-radius: 8px;">
                    <strong style="color: #7df9ff;">Diferencia GC:</strong><br>
                    <span style="color: #00f0ff; font-size: 1.3em;">¬± ${resumen.diferencia_gc.toFixed(2)}%</span>
                </div>
                <div style="background: rgba(0,240,255,0.1); padding: 15px; border-radius: 8px;">
                    <strong style="color: #7df9ff;">Codones Diferentes:</strong><br>
                    <span style="color: #00f0ff; font-size: 1.3em;">${resumen.codones_diferentes} de ${resumen.total_codones}</span>
                </div>
            </div>
        `;
        document.getElementById('resumen-diferencias').innerHTML = resumenHTML;

        // Genomas lado a lado
        let genomas_html = '';
        
        ['genoma1', 'genoma2'].forEach(key => {
            const g = data[key];
            genomas_html += `
                <div class="genoma-card">
                    <div class="genoma-titulo">üß¨ ${g.nombre}</div>
                    <div class="stat-row">
                        <strong>Longitud:</strong>
                        <span>${(g.longitud / 1_000_000).toFixed(2)} Mb</span>
                    </div>
                    <div class="stat-row">
                        <strong>Genes:</strong>
                        <span>${g.num_genes}</span>
                    </div>
                    <div class="stat-row">
                        <strong>Contenido GC:</strong>
                        <span>${g.gc.toFixed(2)}%</span>
                    </div>
                    <div class="stat-row">
                        <strong>Compactaci√≥n:</strong>
                        <span>${g.compactacion.toFixed(2)}%</span>
                    </div>
                    <div class="stat-row">
                        <strong>Densidad ATG:</strong>
                        <span>${g.densidad_atg.toFixed(2)} por kb</span>
                    </div>
                </div>
            `;
        });
        
        document.getElementById('genomas-info').innerHTML = genomas_html;

        // Diferencias codon por codon
        let diferencias_html = '';
        
        data.diferencias_codones.forEach((diff, idx) => {
            const dir = diff.diferencia > 0 ? '‚Üë' : '‚Üì';
            const color = diff.diferencia > 0 ? '#7df9ff' : '#ff9999';
            
            diferencias_html += `
                <div class="diferencia-item">
                    <div class="diferencia-header">
                        <span class="codon-badge">${diff.codon}</span>
                        <span style="color: ${color}; font-weight: bold; font-size: 1.2em;">${dir} ${Math.abs(diff.diferencia)}</span>
                    </div>
                    <div class="diferencia-valor">
                        <div class="valor-genoma">
                            <strong>${data.genoma1.nombre}:</strong> ${diff[data.genoma1.nombre]}
                        </div>
                        <span class="flecha-diferencia">‚Üí</span>
                        <div class="valor-genoma">
                            <strong>${data.genoma2.nombre}:</strong> ${diff[data.genoma2.nombre]}
                        </div>
                    </div>
                    <p style="color: #7df9ff; font-size: 0.9em; margin-top: 8px;">
                        Cambio: ${diff.porcentaje_diff.toFixed(1)}%
                    </p>
                </div>
            `;
        });
        
        document.getElementById('diferencias-codones').innerHTML = diferencias_html;
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');

        if (tabName === 'genes') {
            buscarGenes();
        } else if (tabName === 'comparativa') {
            cargarGenomosDisponibles();
        } else if (tabName === 'codones') {
            crearGraficoStopCodons();
        }
    }

    function crearGraficoStopCodons() {
        const ctx = document.getElementById('stopCodonChart');
        if (!ctx) return;

        const codones = ['TAA', 'TAG', 'TGA'];
        const cantidades = [{{ stop_codons_terminadores.TAA }}, {{ stop_codons_terminadores.TAG }}, {{ stop_codons_terminadores.TGA }}];
        const porcentajes = [{{ "%.2f"|format(stop_props_terminadores.TAA) }}, {{ "%.2f"|format(stop_props_terminadores.TAG) }}, {{ "%.2f"|format(stop_props_terminadores.TGA) }}];

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: codones.map((c, i) => `${c}: ${porcentajes[i]}% (${cantidades[i]})`),
                datasets: [{
                    data: cantidades,
                    backgroundColor: ['#00f0ff', '#7df9ff', '#ff6b6b'],
                    borderColor: '#050012',
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { 
                            color: '#00f0ff',
                            font: { size: 14, weight: 'bold' },
                            padding: 20
                        }
                    }
                }
            }
        });
    }

    function mostrarAnalisisStop(tipo) {
        const btnTerm = document.getElementById('btn-term');
        const btnTotal = document.getElementById('btn-total');
        const contTerm = document.getElementById('contenido-terminadores');
        const contTotal = document.getElementById('contenido-totales');

        if (tipo === 'terminadores') {
            btnTerm.style.background = '#00f0ff';
            btnTerm.style.color = '#000';
            btnTotal.style.background = 'rgba(10, 10, 40, 0.6)';
            btnTotal.style.color = '#00f0ff';
            btnTotal.style.border = '1px solid #00f0ff';
            contTerm.style.display = 'block';
            contTotal.style.display = 'none';
        } else {
            btnTotal.style.background = '#00f0ff';
            btnTotal.style.color = '#000';
            btnTerm.style.background = 'rgba(10, 10, 40, 0.6)';
            btnTerm.style.color = '#00f0ff';
            btnTerm.style.border = '1px solid #00f0ff';
            contTotal.style.display = 'block';
            contTerm.style.display = 'none';
        }
    }

    async function buscarGenes() {
        const search = document.getElementById('search-genes')?.value || '';
        try {
            const response = await fetch(`/api/genes?search=${encodeURIComponent(search)}`);
            const data = await response.json();

            let html = `<div class="table-wrapper"><table>
                <thead><tr><th>#</th><th>Gen</th><th>Producto</th><th>ID Prote√≠na</th><th>Longitud (pb)</th><th>Acci√≥n</th></tr></thead>
                <tbody>`;

            data.genes.forEach((gen, idx) => {
                html += `<tr>
                    <td>${idx + 1}</td>
                    <td><strong>${gen.gen}</strong></td>
                    <td>${gen.producto.substring(0, 50)}</td>
                    <td>${gen.id_proteina}</td>
                    <td>${gen.longitud}</td>
                    <td><button onclick="mostrarDetallesGen(${gen.id})" style="padding: 6px 12px; background: #00f0ff; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">üëÅ Ver</button></td>
                </tr>`;
            });

            html += `</tbody></table></div>`;
            document.getElementById('genes-results').innerHTML = html;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('genes-results').innerHTML = '<p style="color: #ff6b6b;">Error al cargar genes</p>';
        }
    }

    async function mostrarDetallesGen(genId) {
        try {
            const response = await fetch(`/api/gen/${genId}`);
            const data = await response.json();

            let html = `
                <div class="gen-detalle">
                    <div class="gen-titulo">üß¨ ${data.gen.gen}</div>
                    <p><strong>Producto:</strong> ${data.gen.producto}</p>
                    <p><strong>ID Prote√≠na:</strong> ${data.gen.id_proteina}</p>
                    <p><strong>Longitud Gen√≥mica:</strong> ${data.gen.longitud} pb</p>
                    <p><strong>Contenido GC:</strong> ${data.gen.gc_gen.toFixed(2)}%</p>
                    <p><strong>Posici√≥n:</strong> ${data.gen.inicio} - ${data.gen.fin}</p>
                    
                    <h3 style="color: #00f0ff; margin-top: 20px;">üß™ S√≠ntesis de Prote√≠na</h3>
                    <p><strong>Secuencia de Prote√≠na (${data.tama√±o_proteina} amino√°cidos):</strong></p>
                    <p style="font-family: monospace; background: rgba(0,240,255,0.1); padding: 15px; border-radius: 5px; word-break: break-all; max-height: 200px; overflow-y: auto; border: 1px solid #00f0ff33;">
                        ${data.proteina_sintesis}
                    </p>

                    <h3 style="color: #00f0ff; margin-top: 20px;">üî¨ Top 12 Codones en este Gen</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
            `;

            for (const [codon, count] of Object.entries(data.codones_frecuentes).slice(0, 12)) {
                html += `<div style="background: rgba(125, 249, 255, 0.1); padding: 10px; border-radius: 6px; border: 1px solid #7df9ff; text-align: center;">
                    <div style="color: #7df9ff; font-weight: bold; font-family: monospace;">${codon}</div>
                    <div style="color: #00f0ff; font-size: 1.2em; margin-top: 5px;">${count}x</div>
                </div>`;
            }

            html += `</div></div>`;

            document.getElementById('genModalContent').innerHTML = html;
            document.getElementById('genModal').style.display = 'block';
        } catch (error) {
            console.error('Error:', error);
            alert('Error al cargar detalles del gen');
        }
    }

    function cerrarModal() {
        document.getElementById('genModal').style.display = 'none';
    }

    // Cargar genomas al iniciar si estamos en comparativa
    window.addEventListener('load', function() {
        if (document.getElementById('genoma1-select')) {
            cargarGenomosDisponibles();
        }
    });

    // Cerrar modal clickeando afuera
    window.onclick = function(event) {
        const modal = document.getElementById('genModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
</script>

</body>
</html>